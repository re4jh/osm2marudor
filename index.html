<!DOCTYPE html>
<html>

<head>

	<title>Leaflet/OSM/Marudor Demo</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="css/leaflet.css">
	<link rel="stylesheet" href="css/style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
	<script src="js/scripts.js"></script>

</head>

<body>
	<div id="mapid" style=""></div>
	<script>
		var markerid = 0;
		$(function() {
			// Get your License
			$.ajaxSetup({async: false});
			var tf_key;
			$.getJSON("./json_data/api_key_thunderforest.json", function(json) {
				tf_key = json.apikey;
			});
			$.ajaxSetup({async: true});

			var mymap = L.map('mapid').setView([47.780337, 9.589549], 14);

			L.tileLayer('map_cache/transport.php?z={z}&x={x}&y={y}', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
					'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery Â© <a href="https://www.thunderforest.com/">Thunderforest</a>',
				id: 'mapbox/streets-v11'
			}).addTo(mymap);

			var BikeIcon = L.Icon.extend({
				options: {
					iconUrl: 'img/bikesharing.png',
					iconSize: [35, 41]
				}
			});
			var greenBikeIcon = new BikeIcon();

			$.getJSON("./json_data/bikesharing.json", function(json) {
				$.each(json, function(index, value) {
					new_marker = L.marker([value.lat, value.lng], { icon: greenBikeIcon }).addTo(mymap)
						.bindPopup("<b>" + value.name + "</b>")
						.on('click', function(e) {
							onBikeMarkerClick(e, value)
						});
				});
			});

			$.getJSON("./json_data/stops.json", function(json) {
				$.each(json, function(index, value) {
					new_marker = L.marker([value.lat, value.lng]).addTo(mymap)
						.bindPopup("<b>" + value.name + "</b>")
						.on('click', function(e) {
							onMarkerClick(e, value)
						});
				});
			});
		});
	</script>
</body>
</html>
